<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="susussg.pengreenlive.dashboard.Mapper.ProductMapper">

  <select id="findAllProducts" resultType="susussg.pengreenlive.dashboard.DTO.ProductDTO">
    SELECT
      p.PRODUCT_SEQ,
      p.PRODUCT_CD,
      p.GREEN_PRODUCT_ID,
      p.PRODUCT_NM,
      p.LIST_PRICE,
      p.brand,
      p.PRODUCT_IMAGE,
      p.CATEGORY_CD,
      s.PRODUCT_STOCK
    FROM
      TB_PRODUCT p
        LEFT JOIN TB_PRODUCT_STOCK s ON p.PRODUCT_SEQ = s.PRODUCT_SEQ
  </select>

  <select id="findProductsByVendor" resultType="susussg.pengreenlive.dashboard.DTO.VendorProductListDTO">
    SELECT
      p.PRODUCT_SEQ,
      p.PRODUCT_CD,
      p.GREEN_PRODUCT_ID,
      p.PRODUCT_NM,
      p.LIST_PRICE,
      p.BRAND,
      p.PRODUCT_IMAGE,
      p.CATEGORY_CD,
      s.PRODUCT_STOCK
    FROM
      TB_PRODUCT p
        LEFT JOIN TB_PRODUCT_STOCK s ON p.PRODUCT_SEQ = s.PRODUCT_SEQ
        INNER JOIN TB_CHANNEL_SALES_PRODUCT csp ON p.PRODUCT_SEQ = csp.PRODUCT_SEQ
    WHERE
      csp.VENDOR_SEQ = #{venderSeq}
  </select>

  <insert id="insertProduct" parameterType="susussg.pengreenlive.dashboard.DTO.ProductDTO" useGeneratedKeys="true" keyProperty="productSeq">
    INSERT INTO TB_PRODUCT (PRODUCT_CD, GREEN_PRODUCT_ID, PRODUCT_NM, LIST_PRICE, BRAND, PRODUCT_IMAGE, CATEGORY_CD)
    VALUES (#{productCd}, #{greenProductId}, #{productNm}, #{listPrice}, #{brand}, #{base64Image}, #{categoryCd});
  </insert>

  <insert id="insertProductStock" parameterType="susussg.pengreenlive.dashboard.DTO.ProductDTO">
    INSERT INTO TB_PRODUCT_STOCK (PRODUCT_SEQ, PRODUCT_STOCK)
    VALUES (#{productSeq}, #{productStock});
  </insert>

  <insert id="insertChannelSalesProduct" parameterType="susussg.pengreenlive.dashboard.DTO.ProductDTO">
    INSERT INTO TB_CHANNEL_SALES_PRODUCT (PRODUCT_SEQ, VENDOR_SEQ, CHANNEL_SEQ)
    VALUES (#{productSeq}, #{vendorSeq}, #{channelSeq});
  </insert>

  <select id="selectAllCategoryCodes" resultType="susussg.pengreenlive.dashboard.DTO.ProductDTO">
    SELECT CATEGORY_CD, CATEGORY_NM
    FROM TB_PRODUCT_CATEGORY
  </select>

  <update id="updateProduct" parameterType="susussg.pengreenlive.dashboard.DTO.ProductDTO">
    UPDATE TB_PRODUCT
    SET PRODUCT_CD = #{productCd},
        GREEN_PRODUCT_ID = #{greenProductId},
        PRODUCT_NM = #{productNm},
        LIST_PRICE = #{listPrice},
        BRAND = #{brand},
        PRODUCT_IMAGE = #{base64Image},
        CATEGORY_CD = #{categoryCd}
    WHERE PRODUCT_SEQ = #{productSeq};
  </update>

  <update id="updateProductStock" parameterType="susussg.pengreenlive.dashboard.DTO.ProductDTO">
    UPDATE TB_PRODUCT_STOCK
    SET PRODUCT_STOCK = #{productStock}
    WHERE PRODUCT_SEQ = #{productSeq};
  </update>

  <delete id="deleteChannelSalesProduct" parameterType="susussg.pengreenlive.dashboard.DTO.ProductDTO">
    DELETE FROM TB_CHANNEL_SALES_PRODUCT
    WHERE VENDOR_SEQ = #{vendorSeq} AND PRODUCT_SEQ = #{productSeq};
  </delete>


</mapper>
